<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>DDG Proxy Demo</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; max-width: 720px; }
    input[type="text"]{width:80%; padding:.5rem}
    button{padding:.5rem 1rem}
    li{margin:.6rem 0}
  </style>
</head>
<body>
  <h1>DuckDuckGo Proxy Demo</h1>
  <input id="q" type="text" placeholder="search terms" />
  <select id="mode">
    <option value="html">html results</option>
    <option value="api">instant answer (api)</option>
  </select>
  <button id="go">Search</button>

  <pre id="raw" style="white-space:pre-wrap; background:#f7f7f7; padding:1rem"></pre>
  <ul id="out"></ul>

  <script>
    document.getElementById("go").addEventListener("click", async () => {
      const q = document.getElementById("q").value.trim();
      const mode = document.getElementById("mode").value;
      if (!q) return alert("type a query");
      document.getElementById("raw").textContent = "loading...";
      document.getElementById("out").innerHTML = "";
      try {
        const r = await fetch(`/proxy/${mode}?q=` + encodeURIComponent(q));
        const data = await r.json();
        document.getElementById("raw").textContent = JSON.stringify(data, null, 2);
        if (mode === "html" && Array.isArray(data)) {
          const ul = document.getElementById("out");
          data.slice(0, 20).forEach(item => {
            const li = document.createElement("li");
            li.innerHTML = `<a href="${item.href}" target="_blank" rel="noopener">${item.title}</a><br><small>${item.snippet || ""}</small>`;
            ul.appendChild(li);
          });
        }
      } catch (err) {
        document.getElementById("raw").textContent = "error: " + err;
      }
    });
  </script>
</body>
</html>
